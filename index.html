<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>静清ARサンプル（完成版）</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        #controls {
            position: absolute;
            bottom: 10px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }
        #controls button {
            margin: 4px;
            padding: 6px 10px;
        }
    </style>
</head>
<body>

<a-scene embedded arjs="debugUIEnabled:false;">
    <a-assets>
        <a-asset-item id="obj" src="tinker.obj"></a-asset-item>
        <a-asset-item id="mtl" src="obj.mtl"></a-asset-item>
    </a-assets>

    <a-marker type="pattern" url="sei.patt">
        <a-obj-model 
            id="model"
            src="#obj"
            mtl="#mtl"
            scale="0.1 0.1 0.1"
            rotation="807 116 343"
            position="0 0 0">
        </a-obj-model>
    </a-marker>

    <a-entity camera></a-entity>
</a-scene>

<div id="rotationDisplay" style="position:absolute;top:10px;background:rgba(0,0,0,0.5);color:white;padding:6px 10px;border-radius:6px;font-size:14px;">
    Rot X: <span id="rotX">0</span>° |
    Rot Y: <span id="rotY">0</span>° |
    Rot Z: <span id="rotZ">0</span>°
</div>

<div id="controls">
    <button id="rotateX">X回転</button>
    <button id="rotateY">Y回転</button>
    <button id="rotateZ">Z回転</button>
    <button id="rotateStop">停止</button>
    <button id="scaleUp">拡大</button>
    <button id="scaleDown">縮小</button>

    <button id="moveXPlus">X＋</button>
    <button id="moveXMinus">X－</button>
    <button id="moveYPlus">Y＋</button>
    <button id="moveYMinus">Y－</button>
    <button id="moveZPlus">Z＋</button>
    <button id="moveZMinus">Z－</button>

    <button id="capture">撮影</button>
</div>

<script>
window.addEventListener('DOMContentLoaded', () => {
    const model = document.getElementById('model');

    /* ===== 回転 ===== */
    let rotatingAxis = null; // 'x','y','z'
    const rotationSpeed = 1;

    function rotateModel() {
        if (!model) return;
        const rot = model.getAttribute('rotation');

        if (rotatingAxis === 'x') rot.x += rotationSpeed;
        if (rotatingAxis === 'y') rot.y += rotationSpeed;
        if (rotatingAxis === 'z') rot.z += rotationSpeed;

        model.setAttribute('rotation', rot);

        // 回転角表示更新
        document.getElementById('rotX').textContent = rot.x.toFixed(1);
        document.getElementById('rotY').textContent = rot.y.toFixed(1);
        document.getElementById('rotZ').textContent = rot.z.toFixed(1);

        requestAnimationFrame(rotateModel);
    }

    document.getElementById('rotateX').addEventListener('click', () => {
        rotatingAxis = 'x';
    });

    document.getElementById('rotateY').addEventListener('click', () => {
        rotatingAxis = 'y';
    });

    document.getElementById('rotateZ').addEventListener('click', () => {
        rotatingAxis = 'z';
    });

    document.getElementById('rotateStop').addEventListener('click', () => {
        rotatingAxis = null; // 回転停止
    });

    rotateModel();

    /* ===== 拡大・縮小 ===== */
    document.getElementById('scaleUp').addEventListener('click', () => {
        const scale = model.getAttribute('scale');
        scale.x += 0.01;
        scale.y += 0.01;
        scale.z += 0.01;
        model.setAttribute('scale', scale);
    });

    document.getElementById('scaleDown').addEventListener('click', () => {
        const scale = model.getAttribute('scale');
        scale.x = Math.max(0.01, scale.x - 0.01);
        scale.y = Math.max(0.01, scale.y - 0.01);
        scale.z = Math.max(0.01, scale.z - 0.01);
        model.setAttribute('scale', scale);
    });

    /* ===== 移動 ===== */
    const moveStep = 0.05;

    document.getElementById('moveXPlus').addEventListener('click', () => {
        const pos = model.getAttribute('position');
        pos.x += moveStep;
        model.setAttribute('position', pos);
    });

    document.getElementById('moveXMinus').addEventListener('click', () => {
        const pos = model.getAttribute('position');
        pos.x -= moveStep;
        model.setAttribute('position', pos);
    });

    document.getElementById('moveYPlus').addEventListener('click', () => {
        const pos = model.getAttribute('position');
        pos.y += moveStep;
        model.setAttribute('position', pos);
    });

    document.getElementById('moveYMinus').addEventListener('click', () => {
        const pos = model.getAttribute('position');
        pos.y -= moveStep;
        model.setAttribute('position', pos);
    });

    document.getElementById('moveZPlus').addEventListener('click', () => {
        const pos = model.getAttribute('position');
        pos.z += moveStep;
        model.setAttribute('position', pos);
    });

    document.getElementById('moveZMinus').addEventListener('click', () => {
        const pos = model.getAttribute('position');
        pos.z -= moveStep;
        model.setAttribute('position', pos);
    });
});
</script>

</body>
</html>

